{% extends 'base.html' %}

{% block conteudo %}
<div style="text-align: right;">
  <br>
  <a href="{{url_for('router.vagas.Cadastrar')}}" class="btn btn-primary" style="width:10rem;height:2.5rem"
    role='buttom' aria-pressed="true"> Cadastrar Vaga</a>
</div>
<!--Alter -->
<h1 class="titulo-reserva">Reservar Vaga</h1>
<div class="legenda-vagas">
  <div class="legenda-item">
    <div class="quadrado legenda-vaga-verde"></div>
    <p class="texto-legenda">Vaga Livre</p>
  </div>
  <div class="legenda-item">
    <div class="quadrado legenda-vaga-amarela"></div>
    <p class="texto-legenda">Vaga Reservada</p>
  </div>
  <div class="legenda-item">
    <div class="quadrado legenda-vaga-vermelha"></div>
    <p class="texto-legenda">Vaga Ocupada</p>
  </div>
  <div class="legenda-item">
    <div class="legenda-acessibilidade"></div>
    <p class="texto-legenda">Vaga de Acessibilidade</p>
  </div>
</div>
<div class="container" id="container-vagas" data-count-vagas="{{CountVagas}}">

</div>

<script>

  function adicionarVaga() {
    let totalReservada = 0;
    let descriVaga = JSON.parse('{{descricaoVagas |safe}}')
    let usuarioLogado = JSON.parse('{{current_user.id |safe}}')
    let idVagas = JSON.parse('{{idVagas |safe}}')
    // Desestruturando as propriedades do objeto em variáveis separadas
    let { situacaoVaga, IdVaga } = JSON.parse('{{statusVagas |safe}}')
    let container = document.getElementById("container-vagas");
    // ParseInt para garantir que seja tratado como número
    let totalVaga = parseInt(container.dataset.countVagas);
    let cont = 0;
    let vaga ;

    while (cont < totalVaga) {
      totalReservada = 0;
      vaga = document.createElement("div");
      vaga.className = "espaco-vagas";

      // Definindo o ID para cada div de vaga
      vaga.setAttribute("id", idVagas[cont]);
      vaga.setAttribute("value", descriVaga[cont])

      if (vaga.getAttribute("value") === "A") {
        vaga.classList.remove("espaco-vagas");
        vaga.classList.add("espaco-vagas-acessibilidade-livre");
      }
      while(totalReservada < Object.keys(IdVaga).length){
        if (IdVaga[totalReservada] == idVagas[cont]){

          if (vaga.getAttribute("value") === "G" && situacaoVaga[totalReservada] === "O")  {
            vaga.classList.remove("espaco-vagas");
            vaga.classList.add("espaco-vagas-ocupada");

          } else if (vaga.getAttribute("value") === "G" && situacaoVaga[totalReservada] === "R")  {
            vaga.classList.remove("espaco-vagas");
            vaga.classList.add("espaco-vagas-reservada");
          }
          if (vaga.getAttribute("value") === "A"  && situacaoVaga[totalReservada] === "O")  {
            vaga.classList.remove("espaco-vagas");
            vaga.classList.add("espaco-vagas-acessibilidade-ocupada");

          } else if (vaga.getAttribute("value") === "A" && situacaoVaga[totalReservada] === "R")  {
            vaga.classList.remove("espaco-vagas-acessibilidade-livre");
            vaga.classList.add("espaco-vagas-acessibilidade-reservada");

          }else if (vaga.getAttribute("value") === "A") {
            vaga.classList.remove("espaco-vagas-acessibilidade-livre");
            vaga.classList.add("espaco-vagas-acessibilidade-livre");
          }
        }
        totalReservada++;
      }

      container.appendChild(vaga);
      cont++;
    }

  }
  adicionarVaga();
</script>

{% endblock conteudo %}